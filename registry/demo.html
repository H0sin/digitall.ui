<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SignalR Client</title>
    <!-- SignalR از CDN  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>
</head>
<body>
<div>
    <h2>Online Users: <span id="onlineCount">0</span></h2>
</div>

<script>
    const hubUrl = "http://188.245.230.0:8080/usersHubs";

    const connection = new signalR.HubConnectionBuilder()
        .withUrl(hubUrl,{
            accessTokenFactory: () => localStorage.getItem("registry-token")
        })
        .build();

    connection.on("UpdateOnlineCount", (count) => {
        console.log("Online count updated:", count);
        const onlineCountEl = document.getElementById("onlineCount");
        if (onlineCountEl) {
            onlineCountEl.innerText = count;
        }
    });

    connection.start()
        .then(async () => {
            console.log("SignalR connected.");
            const initialCount = await connection.invoke("GetOnlineCountAsync");
            console.log("Initial online count:", initialCount);

            const onlineCountEl = document.getElementById("onlineCount");
            if (onlineCountEl) {
                onlineCountEl.innerText = initialCount;
            }
        })
        .catch(err => {
            console.error("Error in connecting SignalR:", err);
        });
</script>
</body>
</html>
